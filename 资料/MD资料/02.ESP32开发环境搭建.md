# 03.ESP32开发环境搭建

# ESP-IDF 介绍
ESP-IDF (Espressif  IoT  Development  Framework)是乐鑫 ESP32 开发的一套框架，

乐鑫所研发的软件开发环境 ESP-IDF 能够帮助用户快速开发物联网 (IoT) 应用，满足用户对于 Wi-Fi、蓝牙、低功耗等性能的需求。

框架里面包含**<font style="color:red;">很多例程</font>**，是入门和进阶 ESP32 的**<font style="color:red;">优秀参考</font>**。

开发一款芯片的应用程序需要有一套能够编译自己写的应用程序的**<font style="color:red;">工具链</font>**.

类似**<font style="color:red;">STM32</font>**单片机开发使用**<font style="color:red;">keil</font>**，keil 内部已经集成好了编译链，不用设置即可使用，写好应用程序，点击编译按钮即可生成可下载到 STM32 单片机的文件。

乐鑫的**<font style="color:red;">ESP32</font>**不同，他**<font style="color:red;">没有</font>**类似 keil这样的**<font style="color:red;"> IDE </font>**工具，但是官方提供了编译工具链，用户可以使用任何编辑工具（我们使用的是**<font style="color:red;">Visual Studio Code, </font>****<font style="color:red;">以下简称</font>****<font style="color:red;">vscode</font>**），写好应用程序，使用官方提供的编译工具链进行<font style="color:red;">交叉编译</font>，生成可以运行在 ESP32 上的文件。

# 搭建开发环境
## 下载ESP-IDF离线安装包
下载地址: [https://dl.espressif.cn/dl/esp-idf/?idf=4.4](https://dl.espressif.cn/dl/esp-idf/?idf=4.4)

![1750821111384-d39f3fa5-33fc-4991-af1d-c859956fc032.png](./img/5xmRKKoRFpCLgESN/1750821111384-d39f3fa5-33fc-4991-af1d-c859956fc032-947866.png)

## 安装ESP-IDF
![1750821119616-a7a32f5a-60a7-46a7-9c8d-79f162871171.png](./img/5xmRKKoRFpCLgESN/1750821119616-a7a32f5a-60a7-46a7-9c8d-79f162871171-563673.png)

![1750821124825-9f046ad3-b2ed-4ff5-8dc8-f8c9894f184d.png](./img/5xmRKKoRFpCLgESN/1750821124825-9f046ad3-b2ed-4ff5-8dc8-f8c9894f184d-978614.png)

![1750821129797-ada31ee1-5fde-4f98-b89b-2af934407128.png](./img/5xmRKKoRFpCLgESN/1750821129797-ada31ee1-5fde-4f98-b89b-2af934407128-789493.png)

<font style="color:red;">如果有提示</font><font style="color:red;">”</font><font style="color:red;">应用修复</font><font style="color:red;">”, </font><font style="color:red;">先点击</font><font style="color:red;">”</font><font style="color:red;">应用修复</font><font style="color:red;">”,</font><font style="color:red;">再点击下一步</font>

![1750821136511-6495dbe3-976d-44bc-b63e-38aca4660e9c.png](./img/5xmRKKoRFpCLgESN/1750821136511-6495dbe3-976d-44bc-b63e-38aca4660e9c-965672.png)

![1751181021980-6e593460-dbb1-4d11-aa5f-866c95e5b052.png](./img/5xmRKKoRFpCLgESN/1751181021980-6e593460-dbb1-4d11-aa5f-866c95e5b052-945603.png)

<font style="color:red;">只保留</font><font style="color:red;">esp32-c3</font><font style="color:red;">和</font><font style="color:red;">esp32-s3,</font><font style="color:red;">其他的可以清除</font>

![1750821150504-f81af02e-9b7d-4991-b46b-962341de7c4b.png](./img/5xmRKKoRFpCLgESN/1750821150504-f81af02e-9b7d-4991-b46b-962341de7c4b-092644.png)



耐心等待安装完成

![1750821161128-9218835d-15d7-478d-9352-88ca33a02062.png](./img/5xmRKKoRFpCLgESN/1750821161128-9218835d-15d7-478d-9352-88ca33a02062-689936.png)

## 给vscode安装ESP-IDF插件
在vscode插件市场搜索ESP-IDF, 然后点击Install安装插件

![1750821232886-70ed461e-c959-42c8-8454-faa5b673a69d.png](./img/5xmRKKoRFpCLgESN/1750821232886-70ed461e-c959-42c8-8454-faa5b673a69d-737497.png)

## 使用ESP插件配置ESP环境
在vscode中, 点击菜单View->Command Palette

![1750821245056-7e1bf781-983d-416d-9f21-4bfff85aba76.png](./img/5xmRKKoRFpCLgESN/1750821245056-7e1bf781-983d-416d-9f21-4bfff85aba76-231949.png)

然后输入: Configure esp, 然后选择第一项

![1750821252595-4999324c-45ec-4ed2-8a53-8ff41fb3da57.png](./img/5xmRKKoRFpCLgESN/1750821252595-4999324c-45ec-4ed2-8a53-8ff41fb3da57-157614.png)

等待10s左右会进入如下界面

![1750821258579-b556f214-3d95-4dd3-a924-c0342265a827.png](./img/5xmRKKoRFpCLgESN/1750821258579-b556f214-3d95-4dd3-a924-c0342265a827-072927.png)

点击EXPRESS进入配置界面

![1750821266960-5de8fa4b-ec18-4128-b141-3f2d06ce7fd3.png](./img/5xmRKKoRFpCLgESN/1750821266960-5de8fa4b-ec18-4128-b141-3f2d06ce7fd3-660365.png)

点击Install, 然后等待安装完成即可

![1750821273680-0a1ec9bd-af89-47a0-a414-7b7b5af5fb36.png](./img/5xmRKKoRFpCLgESN/1750821273680-0a1ec9bd-af89-47a0-a414-7b7b5af5fb36-899458.png)

## 注意：安装报错
如果在安装的过程中报错"c:\Espressif\tools\idf-python\3.11.2\python.exe -m pip" is not valid. (ERROR_INVALID_PIP), 则去esp-idf的安装目录:c:\Espressif\tools, 把idf-python目录删除, 然后再点Install重新安装即可。

# 第一个HelloWorld项目
## 创建项目
![1750821341521-16910c00-df75-430b-a719-eca96e638698.png](./img/5xmRKKoRFpCLgESN/1750821341521-16910c00-df75-430b-a719-eca96e638698-843547.png)

![1750821347601-e31a30b9-fc3d-40f8-9bae-93e8f05f491c.png](./img/5xmRKKoRFpCLgESN/1750821347601-e31a30b9-fc3d-40f8-9bae-93e8f05f491c-550668.png)

![1750821352681-883f652f-447d-4212-881d-5f130308f7f6.png](./img/5xmRKKoRFpCLgESN/1750821352681-883f652f-447d-4212-881d-5f130308f7f6-330877.png)

![1750821356770-ed6f53d1-1524-4176-885b-f6ff12637a9a.png](./img/5xmRKKoRFpCLgESN/1750821356770-ed6f53d1-1524-4176-885b-f6ff12637a9a-436789.png)

或者打开对应的目录,用vscode直接打开也可以。

## 修改代码
在main.c中添加如下代码

```c
#include<stdio.h>
#include"esp_task.h"
void app_main(void)
{
    while (1)
    {
        printf("hello atguigu\r\n");
        
        vTaskDelay(1000);
    }
}
```

**<font style="color:red;">说明 </font>**** <font style="color:red;">: </font>**

（1）esp32-idf与freertos深度绑定,程序启动时,会启动一个app主任务,这里的app_main函数就是主任务的函数. 注意函数名是固定的,不能更改。

（2）可以把这个函数作为入口函数, 来创建其他任务

（3）与普通的 FreeRTOS 任务（或嵌入式 C 的 main 函数）不同，app_main 任务可以返回。如果 app_main 函数返回，那么主任务将会被删除。系统将继续运行其他的 RTOS 任务。

（4）因此可以将 app_main 实现为一个创建其他应用任务然后返回的函数，或主应用任务本身。

## 编译运行
![1750821417386-c076c17e-c097-4a81-8d45-ee32f821a53d.png](./img/5xmRKKoRFpCLgESN/1750821417386-c076c17e-c097-4a81-8d45-ee32f821a53d-070799.png)

## 监控串口输出结果
![1750821430086-d5f80ccf-3fe1-47e2-8690-acee57652176.png](./img/5xmRKKoRFpCLgESN/1750821430086-d5f80ccf-3fe1-47e2-8690-acee57652176-112484.png)

![1750821435999-20dad01e-6fac-45a9-a1bd-2ab3f212086a.png](./img/5xmRKKoRFpCLgESN/1750821435999-20dad01e-6fac-45a9-a1bd-2ab3f212086a-921814.png)  

如果能看到串口输出结果,证明Helloworld成功执行!


